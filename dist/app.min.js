var myApp=angular.module("myApp",["ui.router","angularMoment"]);myApp.run(function($rootScope){$rootScope.$on("$stateChangeError",console.log.bind(console))});myApp.controller("mainController",["$scope","$state",function($scope,$state){console.log("mainController loaded")}]);myApp.controller("albumListController",["$scope","albumService","$http","moment",function($scope,albumService,$http,moment){console.log("albumListController loaded");$scope.albums=[];$scope.newAlbum={name:"",date:"",description:""};albumService.getAlbums().then(function(res){$scope.albums=res.data.albums.map(function(album){album.date=moment.unix(album.date).format("YYYY-MM-DD","X");return album})});$scope.saveAlbum=function(){$scope.albums.push($scope.newAlbum);albumService.createAlbum($scope.newAlbum);$scope.newAlbum={name:"",date:"",description:""}}}]);angular.module("myApp").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/");$stateProvider.state("home",{url:"/",templateUrl:"./content/albumList/albumList.content.html",controller:"albumListController"})}]);myApp.service("albumService",["$http",function($http){this.getAlbums=function(){return $http({method:"GET",url:"albums/"})};this.createAlbum=function(album){console.log(album,"service");return $http({method:"POST",url:"albums/",data:{al:album}})}}]);myApp.controller("albumViewController",["$scope","albumService",function($scope,albumService){$scope.photos={}}]);angular.module("myApp").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/");$stateProvider.state("album",{url:"/album/:id",templateUrl:"./content/albumView/albumView.content.html",controller:"albumViewController"})}]);myApp.service("albumViewService",["$http",function($http){this.uploadImage=function(image){return $http({method:"POST",url:"/photos/id",data:{image:image}})}}]);angular.module("myApp").directive("navbar",function(){return{restrict:"E",templateUrl:"./directives/header/header.html"}});angular.module("myApp").directive("auDateMask",function(){return{restrict:"A",require:["?ngModel"],link:function(scope,element,attrs,ngModel){attrs.$observe("auDateMask",function(value){ngModel[0].$validators.dateMask=function(value){var year=value.substring(0,4),month=value.substring(5,7),day=value.substring(8,10);return 10==value.length&&!/[^0-9\-]/.test(value)&&"-"==value.substring(4,5)&&"-"==value.substring(7,8)&&Number(year)>1970&&Number(month)<=12&&Number(month)>0&&Number(day)<=31&&Number(day)>0}})}}});myApp.directive("ngFiles",["$parse",function($parse){return{link:function(scope,element,attrs){var onChange=$parse(attrs.ngFiles);element.on("change",function(event){onChange(scope,{$files:event.target.files})});scope.element=element}}}]);angular.module("myApp").directive("auUploadButton",["albumViewService","$stateParams",function(albumViewService,$stateParams){return{restrict:"E",require:"?ngModel",templateUrl:"./directives/uploader/uploader.content.html",link:function(scope,element,attrs,ngModel){scope.textarea="";scope.getTheFiles=function($files){scope.image=$files[0];var reader=new FileReader;reader.onload=function(evt){scope.$apply(function(scope){scope.image=evt.target.result})};reader.readAsDataURL(scope.image)};scope.uploadFiles=function(){scope.photo={album_id:$stateParams.id,image:scope.image,description:scope.textarea};albumViewService.uploadImage(scope.photo);scope.image=null;scope.textarea="";scope.element[0].value=""}}}}]);